<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Knowledge Graph Explorer</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <style>
        :root {
            color-scheme: light;
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #f8fafc;
            color: #0f172a;
        }

        .layout {
            display: grid;
            grid-template-columns: 360px 1fr;
            height: 100vh;
            transition: grid-template-columns 0.3s ease;
        }

        .layout.sidebar-collapsed {
            grid-template-columns: 0px 1fr;
        }

        .layout.sidebar-disabled {
            grid-template-columns: 1fr;
            width: 100%;
        }

        .layout.sidebar-disabled .main {
            width: 100vw !important;
        }

        .layout.sidebar-disabled .tab-panel {
            padding: 0 !important;
            width: 100vw !important;
        }

        .layout.sidebar-disabled .network-panel {
            width: 100vw !important;
            height: 100vh !important;
            border-radius: 0;
            border: none;
            max-width: none !important;
        }

        .layout.sidebar-disabled #networkCanvas {
            width: 100vw !important;
            height: 100vh !important;
            max-width: none !important;
        }

        /* Force canvas to take full iframe space */
        canvas#networkCanvas {
            width: 100% !important;
            height: 100% !important;
        }

        .sidebar {
            background: #ffffff;
            border-right: 1px solid #e2e8f0;
            padding: 24px 24px 16px;
            overflow-y: auto;
            transition: width 0.3s ease, opacity 0.3s ease;
            display: block; /* Visible in standalone mode */
        }

        .sidebar.collapsed {
            width: 0;
            padding: 24px 0 16px;
            overflow: hidden;
            opacity: 0;
        }

        .sidebar h1 {
            margin: 0 0 8px;
            font-size: 1.5rem;
            font-weight: 600;
        }

        .sidebar p {
            margin: 0 0 20px;
            color: #475569;
            font-size: 0.95rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, minmax(0, 1fr));
            gap: 12px;
            margin-bottom: 24px;
        }

        .stat-card {
            background: #f1f5f9;
            border-radius: 12px;
            padding: 12px;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .section {
            margin-bottom: 24px;
        }

        .section h2 {
            font-size: 1rem;
            margin: 0 0 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.04em;
            color: #1e293b;
        }

        .search-input {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #cbd5f5;
            border-radius: 10px;
            font-size: 0.95rem;
        }

        .search-hint {
            margin-top: 6px;
            font-size: 0.8rem;
            color: #64748b;
        }

        .list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .list-item {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 10px;
            padding: 10px 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9rem;
        }

        .list-item strong {
            font-weight: 600;
        }

        .cluster-item,
        .relation-item {
            border-left: 4px solid transparent;
            text-align: left;
            cursor: pointer;
            transition: background 0.2s ease, transform 0.2s ease;
        }

        .cluster-item:hover,
        .relation-item:hover {
            background: #e2e8f0;
        }

        .cluster-item.active,
        .relation-item.active {
            transform: translateX(4px);
            background: #e2e8f0;
        }

        .cluster-item .meta,
        .relation-item .meta {
            font-size: 0.8rem;
            color: #475569;
        }

        .main {
            display: flex;
            flex-direction: column;
            height: 100vh;
            width: 100%;
        }

        .tab-bar {
            display: flex;
            gap: 8px;
            padding: 16px 20px 0;
            background: #ffffff;
            border-bottom: 1px solid #e2e8f0;
        }

        .tab {
            border: none;
            background: #e2e8f0;
            color: #1e293b;
            padding: 10px 16px;
            border-radius: 999px;
            font-size: 0.95rem;
            cursor: pointer;
            transition: background 0.2s ease, color 0.2s ease;
        }

        .tab.active {
            background: #1d4ed8;
            color: #ffffff;
        }

        .sidebar-toggle {
            position: absolute;
            top: 16px;
            right: 20px;
            background: #ffffff;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 8px 12px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s ease;
            z-index: 10;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            display: none; /* Hidden when sidebar is disabled */
        }

        .sidebar-toggle:hover {
            background: #f8fafc;
            border-color: #cbd5e1;
        }

        .sidebar-toggle::before {
            content: '☰';
            margin-right: 6px;
        }

        .sidebar-toggle.collapsed::before {
            content: '☰';
        }

        .tab-panel {
            flex: 1;
            display: none;
            padding: 16px 20px;
            overflow: hidden;
        }

        .tab-panel.active {
            display: block;
        }

        .network-panel {
            height: calc(100vh - 74px);
            background: #ffffff;
            border-radius: 16px;
            border: 1px solid #e2e8f0;
            overflow: hidden;
        }

        #networkCanvas {
            width: 100%;
            height: 100%;
            background: #ffffff;
            border-radius: 16px;
        }

        #networkCanvas {
            cursor: grab;
        }

        #networkCanvas:active {
            cursor: grabbing;
        }

        .selection-card {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 10px;
            padding: 12px;
            font-size: 0.9rem;
        }

        .selection-card h3 {
            margin: 0 0 8px;
            font-size: 1rem;
        }

        .selection-card ul {
            list-style: none;
            padding-left: 0;
            margin: 0;
        }

        .selection-card li {
            margin-bottom: 4px;
            color: #475569;
        }

        .table-container {
            background: #ffffff;
            border-radius: 16px;
            border: 1px solid #e2e8f0;
            height: calc(100vh - 90px);
            overflow: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th,
        td {
            padding: 10px 14px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
            font-size: 0.9rem;
        }

        th {
            background: #f8fafc;
            position: sticky;
            top: 0;
            z-index: 1;
        }

        .pill {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 2px 10px;
            border-radius: 999px;
            background: #e2e8f0;
            font-size: 0.75rem;
            color: #0f172a;
        }

        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.85rem;
            color: #475569;
        }

        .legend-swatch {
            width: 12px;
            height: 12px;
            border-radius: 999px;
            border: 1px solid rgba(15, 23, 42, 0.25);
        }


        /* Mobile/narrow iframe handling - when sidebar is disabled, use full space */
        @media (max-width: 800px) {
            .layout:not(.sidebar-disabled) {
                grid-template-columns: 1fr;
            }

            .layout:not(.sidebar-disabled) .sidebar {
                height: 280px;
                border-right: none;
                border-bottom: 1px solid #e2e8f0;
            }

            .layout:not(.sidebar-disabled) .main {
                height: calc(100vh - 280px);
            }

            /* When sidebar is disabled (iframe mode), ensure full viewport usage */
            .layout.sidebar-disabled .main {
                width: 100% !important;
                height: 100vh !important;
            }

            .layout.sidebar-disabled .tab-panel {
                padding: 0 !important;
                width: 100% !important;
                height: 100vh !important;
            }

            .layout.sidebar-disabled .network-panel {
                width: 100% !important;
                height: 100vh !important;
                border-radius: 0 !important;
                border: none !important;
                max-width: none !important;
            }

            .layout.sidebar-disabled #networkCanvas {
                width: 100% !important;
                height: 100vh !important;
                max-width: none !important;
            }

            /* Ensure iframe canvas takes full space on mobile */
            canvas#networkCanvas {
                width: 100% !important;
                height: 100% !important;
                min-width: 100% !important;
                min-height: 100% !important;
            }
        }
    </style>
</head>

<body>

    <div class="layout">
        <aside class="sidebar">
            <h1>Knowledge Graph Explorer</h1>
            <p>Search, highlight, and inspect entities and relations to understand how the graph fits together.</p>
            <div class="stats-grid" id="statsGrid"></div>
            <div class="section">
                <h2>Search</h2>
                <input id="searchInput" class="search-input" type="text" placeholder="Search for entities or
                    relations" />
                <div class="search-hint">Matches are highlighted. Press Escape to clear.</div>
            </div>
            <div class="section" id="selectionSection">
                <h2>Selection</h2>
                <div id="selectionDetails" class="selection-card">Click a node or relation in the network to inspect
                    details.</div>
            </div>
            <div class="section">
                <h2>Entity Clusters</h2>
                <div id="clusterList" class="list"></div>
            </div>
            <div class="section">
                <h2>Top Entities</h2>
                <div id="topEntities" class="list"></div>
            </div>
            <div class="section">
                <h2>Top Relations</h2>
                <div id="topRelations" class="list"></div>
            </div>
        </aside>
        <main class="main">
            <button class="sidebar-toggle" id="sidebarToggle" title="Toggle sidebar"></button>
            <div class="tab-bar" style="padding-bottom: 10px; display: none;">
                <button class="tab active" data-tab="network">Network</button>
                <!-- <button class="tab" data-tab="relations">Relations</button>
                <button class="tab" data-tab="insights">Insights</button> -->
            </div>
            <section id="network" class="tab-panel active">
                <div class="network-panel">
                    <canvas id="networkCanvas"></canvas>
                </div>
            </section>
            <!-- <section id="relations" class="tab-panel">
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Subject</th>
                                <th>Relation</th>
                                <th>Object</th>
                            </tr>
                        </thead>
                        <tbody id="relationsTable"></tbody>
                    </table>
                </div>
            </section>
            <section id="insights" class="tab-panel">
                <div class="table-container" style="padding: 20px;">
                    <div id="insightsContent"></div>
                </div>
            </section> -->
        </main>
    </div>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script id="viz-data" type="application/json">
{
  "nodes": [
    {
      "id": "1,2-dimyristoyl-rac-glycero-3-methoxypolyethylene glycol-2000 (DMG-PEG2000)",
      "label": "1,2-dimyristoyl-rac-glycero-3-methoxypolyethylene glycol-2000 (DMG-PEG2000)",
      "cluster": "1,2-dimyristoyl-rac-glycero-3-methoxypolyethylene glycol-2000 (DMG-PEG2000)",
      "color": "#d8bb1b",
      "degree": 1,
      "indegree": 0,
      "outdegree": 1,
      "isRepresentative": true,
      "radius": 20,
      "neighbors": [
        "SM-102"
      ],
      "edgeIds": {
        "incoming": [],
        "outgoing": [
          "e17"
        ]
      }
    },
    {
      "id": "1,2-distearoyl-sn-glycero-3-phosphocholine (DSPC)",
      "label": "1,2-distearoyl-sn-glycero-3-phosphocholine (DSPC)",
      "cluster": "1,2-distearoyl-sn-glycero-3-phosphocholine (DSPC)",
      "color": "#3b9fc9",
      "degree": 2,
      "indegree": 0,
      "outdegree": 2,
      "isRepresentative": true,
      "radius": 22,
      "neighbors": [
        "ALC-0315",
        "SM-102"
      ],
      "edgeIds": {
        "incoming": [],
        "outgoing": [
          "e18",
          "e19"
        ]
      }
    },
    {
      "id": "10mM citrate buffer",
      "label": "10mM citrate buffer",
      "cluster": "10mM citrate buffer",
      "color": "#e8c073",
      "degree": 3,
      "indegree": 2,
      "outdegree": 1,
      "isRepresentative": true,
      "radius": 24,
      "neighbors": [
        "aqueous phase",
        "mRNA",
        "Teknova"
      ],
      "edgeIds": {
        "incoming": [
          "e3",
          "e10"
        ],
        "outgoing": [
          "e29"
        ]
      }
    },
    {
      "id": "14:0 PEG2000 phosphoethanolamine (C14-PEG2000)",
      "label": "14:0 PEG2000 phosphoethanolamine (C14-PEG2000)",
      "cluster": "14:0 PEG2000 phosphoethanolamine (C14-PEG2000)",
      "color": "#d6cd3c",
      "degree": 1,
      "indegree": 0,
      "outdegree": 1,
      "isRepresentative": true,
      "radius": 20,
      "neighbors": [
        "organic phase"
      ],
      "edgeIds": {
        "incoming": [],
        "outgoing": [
          "e20"
        ]
      }
    },
    {
      "id": "18:1 Δ9-cis phosphoethanolamine (DOPE)",
      "label": "18:1 Δ9-cis phosphoethanolamine (DOPE)",
      "cluster": "18:1 Δ9-cis phosphoethanolamine (DOPE)",
      "color": "#3cc646",
      "degree": 1,
      "indegree": 0,
      "outdegree": 1,
      "isRepresentative": true,
      "radius": 20,
      "neighbors": [
        "organic phase"
      ],
      "edgeIds": {
        "incoming": [],
        "outgoing": [
          "e21"
        ]
      }
    },
    {
      "id": "ALC-0159",
      "label": "ALC-0159",
      "cluster": "ALC-0159",
      "color": "#47e543",
      "degree": 1,
      "indegree": 0,
      "outdegree": 1,
      "isRepresentative": true,
      "radius": 20,
      "neighbors": [
        "ALC-0315"
      ],
      "edgeIds": {
        "incoming": [],
        "outgoing": [
          "e22"
        ]
      }
    },
    {
      "id": "ALC-0315",
      "label": "ALC-0315",
      "cluster": "ALC-0315",
      "color": "#da2b86",
      "degree": 5,
      "indegree": 4,
      "outdegree": 1,
      "isRepresentative": true,
      "radius": 28,
      "neighbors": [
        "1,2-distearoyl-sn-glycero-3-phosphocholine (DSPC)",
        "ALC-0159",
        "ALC-0315",
        "cholesterol"
      ],
      "edgeIds": {
        "incoming": [
          "e18",
          "e22",
          "e23",
          "e24"
        ],
        "outgoing": [
          "e23"
        ]
      }
    },
    {
      "id": "aqueous phase",
      "label": "aqueous phase",
      "cluster": "aqueous phase",
      "color": "#58e1c5",
      "degree": 3,
      "indegree": 0,
      "outdegree": 3,
      "isRepresentative": true,
      "radius": 24,
      "neighbors": [
        "10mM citrate buffer",
        "glass syringes",
        "mRNA"
      ],
      "edgeIds": {
        "incoming": [],
        "outgoing": [
          "e3",
          "e4",
          "e12"
        ]
      }
    },
    {
      "id": "B10 formulation",
      "label": "B10 formulation",
      "cluster": "B10 formulation",
      "color": "#8245dd",
      "degree": 1,
      "indegree": 1,
      "outdegree": 0,
      "isRepresentative": true,
      "radius": 20,
      "neighbors": [
        "organic phase"
      ],
      "edgeIds": {
        "incoming": [
          "e32"
        ],
        "outgoing": []
      }
    },
    {
      "id": "cholesterol",
      "label": "cholesterol",
      "cluster": "cholesterol",
      "color": "#47db43",
      "degree": 3,
      "indegree": 0,
      "outdegree": 3,
      "isRepresentative": true,
      "radius": 24,
      "neighbors": [
        "ALC-0315",
        "organic phase",
        "SM-102"
      ],
      "edgeIds": {
        "incoming": [],
        "outgoing": [
          "e24",
          "e25",
          "e26"
        ]
      }
    },
    {
      "id": "ethanol",
      "label": "ethanol",
      "cluster": "ethanol",
      "color": "#ea6eab",
      "degree": 1,
      "indegree": 1,
      "outdegree": 0,
      "isRepresentative": true,
      "radius": 20,
      "neighbors": [
        "organic phase"
      ],
      "edgeIds": {
        "incoming": [
          "e11"
        ],
        "outgoing": []
      }
    },
    {
      "id": "glass syringes",
      "label": "glass syringes",
      "cluster": "glass syringes",
      "color": "#e47de0",
      "degree": 4,
      "indegree": 2,
      "outdegree": 2,
      "isRepresentative": true,
      "radius": 26,
      "neighbors": [
        "aqueous phase",
        "Hamilton Company",
        "organic phase",
        "Pump 33 DDS syringe pump"
      ],
      "edgeIds": {
        "incoming": [
          "e12",
          "e13"
        ],
        "outgoing": [
          "e0",
          "e30"
        ]
      }
    },
    {
      "id": "Hamilton Company",
      "label": "Hamilton Company",
      "cluster": "Hamilton Company",
      "color": "#de743a",
      "degree": 2,
      "indegree": 1,
      "outdegree": 1,
      "isRepresentative": true,
      "radius": 22,
      "neighbors": [
        "glass syringes",
        "Reno, NV"
      ],
      "edgeIds": {
        "incoming": [
          "e30"
        ],
        "outgoing": [
          "e14"
        ]
      }
    },
    {
      "id": "Harvard Apparatus",
      "label": "Harvard Apparatus",
      "cluster": "Harvard Apparatus",
      "color": "#22dd7f",
      "degree": 2,
      "indegree": 1,
      "outdegree": 1,
      "isRepresentative": true,
      "radius": 22,
      "neighbors": [
        "MA, USA",
        "Pump 33 DDS syringe pump"
      ],
      "edgeIds": {
        "incoming": [
          "e31"
        ],
        "outgoing": [
          "e15"
        ]
      }
    },
    {
      "id": "Hollister, CA, USA",
      "label": "Hollister, CA, USA",
      "cluster": "Hollister, CA, USA",
      "color": "#47a6e8",
      "degree": 1,
      "indegree": 1,
      "outdegree": 0,
      "isRepresentative": true,
      "radius": 20,
      "neighbors": [
        "Teknova"
      ],
      "edgeIds": {
        "incoming": [
          "e16"
        ],
        "outgoing": []
      }
    },
    {
      "id": "IL",
      "label": "IL",
      "cluster": "IL",
      "color": "#edee5a",
      "degree": 1,
      "indegree": 1,
      "outdegree": 0,
      "isRepresentative": true,
      "radius": 20,
      "neighbors": [
        "mRNA LNP"
      ],
      "edgeIds": {
        "incoming": [
          "e5"
        ],
        "outgoing": []
      }
    },
    {
      "id": "MA, USA",
      "label": "MA, USA",
      "cluster": "MA, USA",
      "color": "#31b69b",
      "degree": 1,
      "indegree": 1,
      "outdegree": 0,
      "isRepresentative": true,
      "radius": 20,
      "neighbors": [
        "Harvard Apparatus"
      ],
      "edgeIds": {
        "incoming": [
          "e15"
        ],
        "outgoing": []
      }
    },
    {
      "id": "microfluidic device",
      "label": "microfluidic device",
      "cluster": "microfluidic device",
      "color": "#7067e5",
      "degree": 4,
      "indegree": 1,
      "outdegree": 3,
      "isRepresentative": true,
      "radius": 26,
      "neighbors": [
        "polydimethylsiloxane",
        "Pump 33 DDS syringe pump",
        "soft lithographic procedures",
        "staggered herringbone micromixer design"
      ],
      "edgeIds": {
        "incoming": [
          "e8"
        ],
        "outgoing": [
          "e1",
          "e2",
          "e7"
        ]
      }
    },
    {
      "id": "mixing channel",
      "label": "mixing channel",
      "cluster": "mixing channel",
      "color": "#c821cf",
      "degree": 1,
      "indegree": 0,
      "outdegree": 1,
      "isRepresentative": true,
      "radius": 20,
      "neighbors": [
        "silicon wafer"
      ],
      "edgeIds": {
        "incoming": [],
        "outgoing": [
          "e27"
        ]
      }
    },
    {
      "id": "mRNA",
      "label": "mRNA",
      "cluster": "mRNA",
      "color": "#8971e5",
      "degree": 3,
      "indegree": 2,
      "outdegree": 1,
      "isRepresentative": true,
      "radius": 24,
      "neighbors": [
        "10mM citrate buffer",
        "aqueous phase",
        "mRNA LNP"
      ],
      "edgeIds": {
        "incoming": [
          "e4",
          "e6"
        ],
        "outgoing": [
          "e10"
        ]
      }
    },
    {
      "id": "mRNA LNP",
      "label": "mRNA LNP",
      "cluster": "mRNA LNP",
      "color": "#a147d5",
      "degree": 2,
      "indegree": 0,
      "outdegree": 2,
      "isRepresentative": true,
      "radius": 22,
      "neighbors": [
        "IL",
        "mRNA"
      ],
      "edgeIds": {
        "incoming": [],
        "outgoing": [
          "e5",
          "e6"
        ]
      }
    },
    {
      "id": "organic phase",
      "label": "organic phase",
      "cluster": "organic phase",
      "color": "#75e44e",
      "degree": 6,
      "indegree": 3,
      "outdegree": 3,
      "isRepresentative": true,
      "radius": 30,
      "neighbors": [
        "14:0 PEG2000 phosphoethanolamine (C14-PEG2000)",
        "18:1 Δ9-cis phosphoethanolamine (DOPE)",
        "B10 formulation",
        "cholesterol",
        "ethanol",
        "glass syringes"
      ],
      "edgeIds": {
        "incoming": [
          "e20",
          "e21",
          "e25"
        ],
        "outgoing": [
          "e11",
          "e13",
          "e32"
        ]
      }
    },
    {
      "id": "polydimethylsiloxane",
      "label": "polydimethylsiloxane",
      "cluster": "polydimethylsiloxane",
      "color": "#de4ee0",
      "degree": 1,
      "indegree": 1,
      "outdegree": 0,
      "isRepresentative": true,
      "radius": 20,
      "neighbors": [
        "microfluidic device"
      ],
      "edgeIds": {
        "incoming": [
          "e2"
        ],
        "outgoing": []
      }
    },
    {
      "id": "Pump 33 DDS syringe pump",
      "label": "Pump 33 DDS syringe pump",
      "cluster": "Pump 33 DDS syringe pump",
      "color": "#5782f1",
      "degree": 3,
      "indegree": 1,
      "outdegree": 2,
      "isRepresentative": true,
      "radius": 24,
      "neighbors": [
        "glass syringes",
        "Harvard Apparatus",
        "microfluidic device"
      ],
      "edgeIds": {
        "incoming": [
          "e0"
        ],
        "outgoing": [
          "e8",
          "e31"
        ]
      }
    },
    {
      "id": "Reno, NV",
      "label": "Reno, NV",
      "cluster": "Reno, NV",
      "color": "#8ae757",
      "degree": 1,
      "indegree": 1,
      "outdegree": 0,
      "isRepresentative": true,
      "radius": 20,
      "neighbors": [
        "Hamilton Company"
      ],
      "edgeIds": {
        "incoming": [
          "e14"
        ],
        "outgoing": []
      }
    },
    {
      "id": "silicon wafer",
      "label": "silicon wafer",
      "cluster": "silicon wafer",
      "color": "#722fed",
      "degree": 2,
      "indegree": 2,
      "outdegree": 0,
      "isRepresentative": true,
      "radius": 22,
      "neighbors": [
        "mixing channel",
        "SU-8 master"
      ],
      "edgeIds": {
        "incoming": [
          "e9",
          "e27"
        ],
        "outgoing": []
      }
    },
    {
      "id": "SM-102",
      "label": "SM-102",
      "cluster": "SM-102",
      "color": "#dec671",
      "degree": 5,
      "indegree": 4,
      "outdegree": 1,
      "isRepresentative": true,
      "radius": 28,
      "neighbors": [
        "1,2-dimyristoyl-rac-glycero-3-methoxypolyethylene glycol-2000 (DMG-PEG2000)",
        "1,2-distearoyl-sn-glycero-3-phosphocholine (DSPC)",
        "cholesterol",
        "SM-102"
      ],
      "edgeIds": {
        "incoming": [
          "e17",
          "e19",
          "e26",
          "e28"
        ],
        "outgoing": [
          "e28"
        ]
      }
    },
    {
      "id": "soft lithographic procedures",
      "label": "soft lithographic procedures",
      "cluster": "soft lithographic procedures",
      "color": "#e55ba9",
      "degree": 1,
      "indegree": 1,
      "outdegree": 0,
      "isRepresentative": true,
      "radius": 20,
      "neighbors": [
        "microfluidic device"
      ],
      "edgeIds": {
        "incoming": [
          "e1"
        ],
        "outgoing": []
      }
    },
    {
      "id": "staggered herringbone micromixer design",
      "label": "staggered herringbone micromixer design",
      "cluster": "staggered herringbone micromixer design",
      "color": "#46dac7",
      "degree": 1,
      "indegree": 1,
      "outdegree": 0,
      "isRepresentative": true,
      "radius": 20,
      "neighbors": [
        "microfluidic device"
      ],
      "edgeIds": {
        "incoming": [
          "e7"
        ],
        "outgoing": []
      }
    },
    {
      "id": "SU-8 master",
      "label": "SU-8 master",
      "cluster": "SU-8 master",
      "color": "#797ee5",
      "degree": 1,
      "indegree": 0,
      "outdegree": 1,
      "isRepresentative": true,
      "radius": 20,
      "neighbors": [
        "silicon wafer"
      ],
      "edgeIds": {
        "incoming": [],
        "outgoing": [
          "e9"
        ]
      }
    },
    {
      "id": "Teknova",
      "label": "Teknova",
      "cluster": "Teknova",
      "color": "#dd9d80",
      "degree": 2,
      "indegree": 1,
      "outdegree": 1,
      "isRepresentative": true,
      "radius": 22,
      "neighbors": [
        "10mM citrate buffer",
        "Hollister, CA, USA"
      ],
      "edgeIds": {
        "incoming": [
          "e29"
        ],
        "outgoing": [
          "e16"
        ]
      }
    }
  ],
  "edges": [
    {
      "id": "e0",
      "source": "glass syringes",
      "target": "Pump 33 DDS syringe pump",
      "predicate": "are connected to",
      "cluster": "are connected to",
      "color": "#abe27b",
      "tooltip": "glass syringes —are connected to→ Pump 33 DDS syringe pump"
    },
    {
      "id": "e1",
      "source": "microfluidic device",
      "target": "soft lithographic procedures",
      "predicate": "are fabricated by",
      "cluster": "are fabricated by",
      "color": "#bd7fde",
      "tooltip": "microfluidic device —are fabricated by→ soft lithographic procedures"
    },
    {
      "id": "e2",
      "source": "microfluidic device",
      "target": "polydimethylsiloxane",
      "predicate": "are fabricated in",
      "cluster": "are fabricated in",
      "color": "#7977e0",
      "tooltip": "microfluidic device —are fabricated in→ polydimethylsiloxane"
    },
    {
      "id": "e3",
      "source": "aqueous phase",
      "target": "10mM citrate buffer",
      "predicate": "contains",
      "cluster": "contains",
      "color": "#942cd0",
      "tooltip": "aqueous phase —contains→ 10mM citrate buffer"
    },
    {
      "id": "e4",
      "source": "aqueous phase",
      "target": "mRNA",
      "predicate": "contains",
      "cluster": "contains",
      "color": "#942cd0",
      "tooltip": "aqueous phase —contains→ mRNA"
    },
    {
      "id": "e5",
      "source": "mRNA LNP",
      "target": "IL",
      "predicate": "contains",
      "cluster": "contains",
      "color": "#942cd0",
      "tooltip": "mRNA LNP —contains→ IL"
    },
    {
      "id": "e6",
      "source": "mRNA LNP",
      "target": "mRNA",
      "predicate": "contains",
      "cluster": "contains",
      "color": "#942cd0",
      "tooltip": "mRNA LNP —contains→ mRNA"
    },
    {
      "id": "e7",
      "source": "microfluidic device",
      "target": "staggered herringbone micromixer design",
      "predicate": "has design",
      "cluster": "has design",
      "color": "#cd1eb6",
      "tooltip": "microfluidic device —has design→ staggered herringbone micromixer design"
    },
    {
      "id": "e8",
      "source": "Pump 33 DDS syringe pump",
      "target": "microfluidic device",
      "predicate": "is attached to",
      "cluster": "is attached to",
      "color": "#dd13ab",
      "tooltip": "Pump 33 DDS syringe pump —is attached to→ microfluidic device"
    },
    {
      "id": "e9",
      "source": "SU-8 master",
      "target": "silicon wafer",
      "predicate": "is created on",
      "cluster": "is created on",
      "color": "#55dbd0",
      "tooltip": "SU-8 master —is created on→ silicon wafer"
    },
    {
      "id": "e10",
      "source": "mRNA",
      "target": "10mM citrate buffer",
      "predicate": "is dissolved in",
      "cluster": "is dissolved in",
      "color": "#b330c6",
      "tooltip": "mRNA —is dissolved in→ 10mM citrate buffer"
    },
    {
      "id": "e11",
      "source": "organic phase",
      "target": "ethanol",
      "predicate": "is dissolved in",
      "cluster": "is dissolved in",
      "color": "#b330c6",
      "tooltip": "organic phase —is dissolved in→ ethanol"
    },
    {
      "id": "e12",
      "source": "aqueous phase",
      "target": "glass syringes",
      "predicate": "is loaded in",
      "cluster": "is loaded in",
      "color": "#8e51d3",
      "tooltip": "aqueous phase —is loaded in→ glass syringes"
    },
    {
      "id": "e13",
      "source": "organic phase",
      "target": "glass syringes",
      "predicate": "is loaded in",
      "cluster": "is loaded in",
      "color": "#8e51d3",
      "tooltip": "organic phase —is loaded in→ glass syringes"
    },
    {
      "id": "e14",
      "source": "Hamilton Company",
      "target": "Reno, NV",
      "predicate": "is located in",
      "cluster": "is located in",
      "color": "#4215eb",
      "tooltip": "Hamilton Company —is located in→ Reno, NV"
    },
    {
      "id": "e15",
      "source": "Harvard Apparatus",
      "target": "MA, USA",
      "predicate": "is located in",
      "cluster": "is located in",
      "color": "#4215eb",
      "tooltip": "Harvard Apparatus —is located in→ MA, USA"
    },
    {
      "id": "e16",
      "source": "Teknova",
      "target": "Hollister, CA, USA",
      "predicate": "is located in",
      "cluster": "is located in",
      "color": "#4215eb",
      "tooltip": "Teknova —is located in→ Hollister, CA, USA"
    },
    {
      "id": "e17",
      "source": "1,2-dimyristoyl-rac-glycero-3-methoxypolyethylene glycol-2000 (DMG-PEG2000)",
      "target": "SM-102",
      "predicate": "is part of",
      "cluster": "is part of",
      "color": "#72d458",
      "tooltip": "1,2-dimyristoyl-rac-glycero-3-methoxypolyethylene glycol-2000 (DMG-PEG2000) —is part of→ SM-102"
    },
    {
      "id": "e18",
      "source": "1,2-distearoyl-sn-glycero-3-phosphocholine (DSPC)",
      "target": "ALC-0315",
      "predicate": "is part of",
      "cluster": "is part of",
      "color": "#72d458",
      "tooltip": "1,2-distearoyl-sn-glycero-3-phosphocholine (DSPC) —is part of→ ALC-0315"
    },
    {
      "id": "e19",
      "source": "1,2-distearoyl-sn-glycero-3-phosphocholine (DSPC)",
      "target": "SM-102",
      "predicate": "is part of",
      "cluster": "is part of",
      "color": "#72d458",
      "tooltip": "1,2-distearoyl-sn-glycero-3-phosphocholine (DSPC) —is part of→ SM-102"
    },
    {
      "id": "e20",
      "source": "14:0 PEG2000 phosphoethanolamine (C14-PEG2000)",
      "target": "organic phase",
      "predicate": "is part of",
      "cluster": "is part of",
      "color": "#72d458",
      "tooltip": "14:0 PEG2000 phosphoethanolamine (C14-PEG2000) —is part of→ organic phase"
    },
    {
      "id": "e21",
      "source": "18:1 Δ9-cis phosphoethanolamine (DOPE)",
      "target": "organic phase",
      "predicate": "is part of",
      "cluster": "is part of",
      "color": "#72d458",
      "tooltip": "18:1 Δ9-cis phosphoethanolamine (DOPE) —is part of→ organic phase"
    },
    {
      "id": "e22",
      "source": "ALC-0159",
      "target": "ALC-0315",
      "predicate": "is part of",
      "cluster": "is part of",
      "color": "#72d458",
      "tooltip": "ALC-0159 —is part of→ ALC-0315"
    },
    {
      "id": "e23",
      "source": "ALC-0315",
      "target": "ALC-0315",
      "predicate": "is part of",
      "cluster": "is part of",
      "color": "#72d458",
      "tooltip": "ALC-0315 —is part of→ ALC-0315"
    },
    {
      "id": "e24",
      "source": "cholesterol",
      "target": "ALC-0315",
      "predicate": "is part of",
      "cluster": "is part of",
      "color": "#72d458",
      "tooltip": "cholesterol —is part of→ ALC-0315"
    },
    {
      "id": "e25",
      "source": "cholesterol",
      "target": "organic phase",
      "predicate": "is part of",
      "cluster": "is part of",
      "color": "#72d458",
      "tooltip": "cholesterol —is part of→ organic phase"
    },
    {
      "id": "e26",
      "source": "cholesterol",
      "target": "SM-102",
      "predicate": "is part of",
      "cluster": "is part of",
      "color": "#72d458",
      "tooltip": "cholesterol —is part of→ SM-102"
    },
    {
      "id": "e27",
      "source": "mixing channel",
      "target": "silicon wafer",
      "predicate": "is part of",
      "cluster": "is part of",
      "color": "#72d458",
      "tooltip": "mixing channel —is part of→ silicon wafer"
    },
    {
      "id": "e28",
      "source": "SM-102",
      "target": "SM-102",
      "predicate": "is part of",
      "cluster": "is part of",
      "color": "#72d458",
      "tooltip": "SM-102 —is part of→ SM-102"
    },
    {
      "id": "e29",
      "source": "10mM citrate buffer",
      "target": "Teknova",
      "predicate": "is provided by",
      "cluster": "is provided by",
      "color": "#37cd65",
      "tooltip": "10mM citrate buffer —is provided by→ Teknova"
    },
    {
      "id": "e30",
      "source": "glass syringes",
      "target": "Hamilton Company",
      "predicate": "is provided by",
      "cluster": "is provided by",
      "color": "#37cd65",
      "tooltip": "glass syringes —is provided by→ Hamilton Company"
    },
    {
      "id": "e31",
      "source": "Pump 33 DDS syringe pump",
      "target": "Harvard Apparatus",
      "predicate": "is provided by",
      "cluster": "is provided by",
      "color": "#37cd65",
      "tooltip": "Pump 33 DDS syringe pump —is provided by→ Harvard Apparatus"
    },
    {
      "id": "e32",
      "source": "organic phase",
      "target": "B10 formulation",
      "predicate": "is used in",
      "cluster": "is used in",
      "color": "#a0e56e",
      "tooltip": "organic phase —is used in→ B10 formulation"
    }
  ],
  "clusters": [
    {
      "id": "microfluidic device",
      "label": "microfluidic device",
      "members": [
        "microfluidic device",
        "microfluidic devices"
      ],
      "size": 2,
      "color": "#7067e5"
    },
    {
      "id": "ALC-0315",
      "label": "ALC-0315",
      "members": [
        "ALC-0315",
        "ALC-0315 LNP"
      ],
      "size": 2,
      "color": "#da2b86"
    },
    {
      "id": "SM-102",
      "label": "SM-102",
      "members": [
        "SM-102",
        "SM-102 LNP"
      ],
      "size": 2,
      "color": "#dec671"
    },
    {
      "id": "mRNA",
      "label": "mRNA",
      "members": [
        "mRNA"
      ],
      "size": 1,
      "color": "#8971e5"
    },
    {
      "id": "organic phase",
      "label": "organic phase",
      "members": [
        "organic phase"
      ],
      "size": 1,
      "color": "#75e44e"
    },
    {
      "id": "Pump 33 DDS syringe pump",
      "label": "Pump 33 DDS syringe pump",
      "members": [
        "Pump 33 DDS syringe pump"
      ],
      "size": 1,
      "color": "#5782f1"
    },
    {
      "id": "ethanol",
      "label": "ethanol",
      "members": [
        "ethanol"
      ],
      "size": 1,
      "color": "#ea6eab"
    },
    {
      "id": "B10 formulation",
      "label": "B10 formulation",
      "members": [
        "B10 formulation"
      ],
      "size": 1,
      "color": "#8245dd"
    },
    {
      "id": "soft lithographic procedures",
      "label": "soft lithographic procedures",
      "members": [
        "soft lithographic procedures"
      ],
      "size": 1,
      "color": "#e55ba9"
    },
    {
      "id": "silicon wafer",
      "label": "silicon wafer",
      "members": [
        "silicon wafer"
      ],
      "size": 1,
      "color": "#722fed"
    },
    {
      "id": "mRNA LNP",
      "label": "mRNA LNP",
      "members": [
        "mRNA LNP"
      ],
      "size": 1,
      "color": "#a147d5"
    },
    {
      "id": "SU-8 master",
      "label": "SU-8 master",
      "members": [
        "SU-8 master"
      ],
      "size": 1,
      "color": "#797ee5"
    },
    {
      "id": "MA, USA",
      "label": "MA, USA",
      "members": [
        "MA, USA"
      ],
      "size": 1,
      "color": "#31b69b"
    },
    {
      "id": "mixing channel",
      "label": "mixing channel",
      "members": [
        "mixing channel"
      ],
      "size": 1,
      "color": "#c821cf"
    },
    {
      "id": "Reno, NV",
      "label": "Reno, NV",
      "members": [
        "Reno, NV"
      ],
      "size": 1,
      "color": "#8ae757"
    },
    {
      "id": "18:1 Δ9-cis phosphoethanolamine (DOPE)",
      "label": "18:1 Δ9-cis phosphoethanolamine (DOPE)",
      "members": [
        "18:1 Δ9-cis phosphoethanolamine (DOPE)"
      ],
      "size": 1,
      "color": "#3cc646"
    },
    {
      "id": "glass syringes",
      "label": "glass syringes",
      "members": [
        "glass syringes"
      ],
      "size": 1,
      "color": "#e47de0"
    },
    {
      "id": "IL",
      "label": "IL",
      "members": [
        "IL"
      ],
      "size": 1,
      "color": "#edee5a"
    },
    {
      "id": "ALC-0159",
      "label": "ALC-0159",
      "members": [
        "ALC-0159"
      ],
      "size": 1,
      "color": "#47e543"
    },
    {
      "id": "polydimethylsiloxane",
      "label": "polydimethylsiloxane",
      "members": [
        "polydimethylsiloxane"
      ],
      "size": 1,
      "color": "#de4ee0"
    },
    {
      "id": "cholesterol",
      "label": "cholesterol",
      "members": [
        "cholesterol"
      ],
      "size": 1,
      "color": "#47db43"
    },
    {
      "id": "Teknova",
      "label": "Teknova",
      "members": [
        "Teknova"
      ],
      "size": 1,
      "color": "#dd9d80"
    },
    {
      "id": "Hollister, CA, USA",
      "label": "Hollister, CA, USA",
      "members": [
        "Hollister, CA, USA"
      ],
      "size": 1,
      "color": "#47a6e8"
    },
    {
      "id": "1,2-dimyristoyl-rac-glycero-3-methoxypolyethylene glycol-2000 (DMG-PEG2000)",
      "label": "1,2-dimyristoyl-rac-glycero-3-methoxypolyethylene glycol-2000 (DMG-PEG2000)",
      "members": [
        "1,2-dimyristoyl-rac-glycero-3-methoxypolyethylene glycol-2000 (DMG-PEG2000)"
      ],
      "size": 1,
      "color": "#d8bb1b"
    },
    {
      "id": "aqueous phase",
      "label": "aqueous phase",
      "members": [
        "aqueous phase"
      ],
      "size": 1,
      "color": "#58e1c5"
    },
    {
      "id": "1,2-distearoyl-sn-glycero-3-phosphocholine (DSPC)",
      "label": "1,2-distearoyl-sn-glycero-3-phosphocholine (DSPC)",
      "members": [
        "1,2-distearoyl-sn-glycero-3-phosphocholine (DSPC)"
      ],
      "size": 1,
      "color": "#3b9fc9"
    },
    {
      "id": "Hamilton Company",
      "label": "Hamilton Company",
      "members": [
        "Hamilton Company"
      ],
      "size": 1,
      "color": "#de743a"
    },
    {
      "id": "staggered herringbone micromixer design",
      "label": "staggered herringbone micromixer design",
      "members": [
        "staggered herringbone micromixer design"
      ],
      "size": 1,
      "color": "#46dac7"
    },
    {
      "id": "10mM citrate buffer",
      "label": "10mM citrate buffer",
      "members": [
        "10mM citrate buffer"
      ],
      "size": 1,
      "color": "#e8c073"
    },
    {
      "id": "Harvard Apparatus",
      "label": "Harvard Apparatus",
      "members": [
        "Harvard Apparatus"
      ],
      "size": 1,
      "color": "#22dd7f"
    },
    {
      "id": "14:0 PEG2000 phosphoethanolamine (C14-PEG2000)",
      "label": "14:0 PEG2000 phosphoethanolamine (C14-PEG2000)",
      "members": [
        "14:0 PEG2000 phosphoethanolamine (C14-PEG2000)"
      ],
      "size": 1,
      "color": "#d6cd3c"
    }
  ],
  "edgeClusters": [
    {
      "id": "is provided by",
      "label": "is provided by",
      "members": [
        "are provided by",
        "is provided by"
      ],
      "size": 2,
      "color": "#37cd65"
    },
    {
      "id": "is part of",
      "label": "is part of",
      "members": [
        "is component of",
        "is part of"
      ],
      "size": 2,
      "color": "#72d458"
    },
    {
      "id": "are connected to",
      "label": "are connected to",
      "members": [
        "are connected to"
      ],
      "size": 1,
      "color": "#abe27b"
    },
    {
      "id": "contains",
      "label": "contains",
      "members": [
        "contains"
      ],
      "size": 1,
      "color": "#942cd0"
    },
    {
      "id": "are fabricated in",
      "label": "are fabricated in",
      "members": [
        "are fabricated in"
      ],
      "size": 1,
      "color": "#7977e0"
    },
    {
      "id": "is attached to",
      "label": "is attached to",
      "members": [
        "is attached to"
      ],
      "size": 1,
      "color": "#dd13ab"
    },
    {
      "id": "is created on",
      "label": "is created on",
      "members": [
        "is created on"
      ],
      "size": 1,
      "color": "#55dbd0"
    },
    {
      "id": "is loaded in",
      "label": "is loaded in",
      "members": [
        "is loaded in"
      ],
      "size": 1,
      "color": "#8e51d3"
    },
    {
      "id": "are fabricated by",
      "label": "are fabricated by",
      "members": [
        "are fabricated by"
      ],
      "size": 1,
      "color": "#bd7fde"
    },
    {
      "id": "is dissolved in",
      "label": "is dissolved in",
      "members": [
        "is dissolved in"
      ],
      "size": 1,
      "color": "#b330c6"
    },
    {
      "id": "has design",
      "label": "has design",
      "members": [
        "has design"
      ],
      "size": 1,
      "color": "#cd1eb6"
    },
    {
      "id": "is used in",
      "label": "is used in",
      "members": [
        "is used in"
      ],
      "size": 1,
      "color": "#a0e56e"
    },
    {
      "id": "is located in",
      "label": "is located in",
      "members": [
        "is located in"
      ],
      "size": 1,
      "color": "#4215eb"
    }
  ],
  "topEntities": [
    {
      "label": "organic phase",
      "degree": 6,
      "indegree": 3,
      "outdegree": 3,
      "cluster": "organic phase"
    },
    {
      "label": "ALC-0315",
      "degree": 5,
      "indegree": 4,
      "outdegree": 1,
      "cluster": "ALC-0315"
    },
    {
      "label": "SM-102",
      "degree": 5,
      "indegree": 4,
      "outdegree": 1,
      "cluster": "SM-102"
    },
    {
      "label": "glass syringes",
      "degree": 4,
      "indegree": 2,
      "outdegree": 2,
      "cluster": "glass syringes"
    },
    {
      "label": "microfluidic device",
      "degree": 4,
      "indegree": 1,
      "outdegree": 3,
      "cluster": "microfluidic device"
    },
    {
      "label": "10mM citrate buffer",
      "degree": 3,
      "indegree": 2,
      "outdegree": 1,
      "cluster": "10mM citrate buffer"
    },
    {
      "label": "aqueous phase",
      "degree": 3,
      "indegree": 0,
      "outdegree": 3,
      "cluster": "aqueous phase"
    },
    {
      "label": "cholesterol",
      "degree": 3,
      "indegree": 0,
      "outdegree": 3,
      "cluster": "cholesterol"
    },
    {
      "label": "mRNA",
      "degree": 3,
      "indegree": 2,
      "outdegree": 1,
      "cluster": "mRNA"
    },
    {
      "label": "Pump 33 DDS syringe pump",
      "degree": 3,
      "indegree": 1,
      "outdegree": 2,
      "cluster": "Pump 33 DDS syringe pump"
    }
  ],
  "topRelations": [
    {
      "predicate": "is part of",
      "count": 12,
      "cluster": "is part of",
      "color": "#72d458"
    },
    {
      "predicate": "contains",
      "count": 4,
      "cluster": "contains",
      "color": "#942cd0"
    },
    {
      "predicate": "is located in",
      "count": 3,
      "cluster": "is located in",
      "color": "#4215eb"
    },
    {
      "predicate": "is provided by",
      "count": 3,
      "cluster": "is provided by",
      "color": "#37cd65"
    },
    {
      "predicate": "is dissolved in",
      "count": 2,
      "cluster": "is dissolved in",
      "color": "#b330c6"
    },
    {
      "predicate": "is loaded in",
      "count": 2,
      "cluster": "is loaded in",
      "color": "#8e51d3"
    },
    {
      "predicate": "are connected to",
      "count": 1,
      "cluster": "are connected to",
      "color": "#abe27b"
    },
    {
      "predicate": "are fabricated by",
      "count": 1,
      "cluster": "are fabricated by",
      "color": "#bd7fde"
    },
    {
      "predicate": "are fabricated in",
      "count": 1,
      "cluster": "are fabricated in",
      "color": "#7977e0"
    },
    {
      "predicate": "has design",
      "count": 1,
      "cluster": "has design",
      "color": "#cd1eb6"
    }
  ],
  "stats": {
    "entities": 31,
    "relations": 33,
    "relationTypes": 13,
    "entityClusters": 31,
    "edgeClusters": 13,
    "isolatedEntities": 0,
    "components": 2,
    "averageDegree": 2.13,
    "density": 0.035
  },
  "isolatedEntities": [],
  "components": [
    {
      "size": 28,
      "members": [
        "1,2-dimyristoyl-rac-glycero-3-methoxypolyethylene glycol-2000 (DMG-PEG2000)",
        "1,2-distearoyl-sn-glycero-3-phosphocholine (DSPC)",
        "10mM citrate buffer",
        "14:0 PEG2000 phosphoethanolamine (C14-PEG2000)",
        "18:1 Δ9-cis phosphoethanolamine (DOPE)",
        "ALC-0159",
        "ALC-0315",
        "aqueous phase",
        "B10 formulation",
        "cholesterol",
        "ethanol",
        "glass syringes",
        "Hamilton Company",
        "Harvard Apparatus",
        "Hollister, CA, USA",
        "IL",
        "MA, USA",
        "microfluidic device",
        "mRNA",
        "mRNA LNP",
        "organic phase",
        "polydimethylsiloxane",
        "Pump 33 DDS syringe pump",
        "Reno, NV",
        "SM-102",
        "soft lithographic procedures",
        "staggered herringbone micromixer design",
        "Teknova"
      ]
    },
    {
      "size": 3,
      "members": [
        "mixing channel",
        "silicon wafer",
        "SU-8 master"
      ]
    }
  ],
  "relations": [
    {
      "source": "glass syringes",
      "predicate": "are connected to",
      "target": "Pump 33 DDS syringe pump",
      "edgeId": "e0",
      "color": "#abe27b"
    },
    {
      "source": "microfluidic device",
      "predicate": "are fabricated by",
      "target": "soft lithographic procedures",
      "edgeId": "e1",
      "color": "#bd7fde"
    },
    {
      "source": "microfluidic device",
      "predicate": "are fabricated in",
      "target": "polydimethylsiloxane",
      "edgeId": "e2",
      "color": "#7977e0"
    },
    {
      "source": "aqueous phase",
      "predicate": "contains",
      "target": "10mM citrate buffer",
      "edgeId": "e3",
      "color": "#942cd0"
    },
    {
      "source": "aqueous phase",
      "predicate": "contains",
      "target": "mRNA",
      "edgeId": "e4",
      "color": "#942cd0"
    },
    {
      "source": "mRNA LNP",
      "predicate": "contains",
      "target": "IL",
      "edgeId": "e5",
      "color": "#942cd0"
    },
    {
      "source": "mRNA LNP",
      "predicate": "contains",
      "target": "mRNA",
      "edgeId": "e6",
      "color": "#942cd0"
    },
    {
      "source": "microfluidic device",
      "predicate": "has design",
      "target": "staggered herringbone micromixer design",
      "edgeId": "e7",
      "color": "#cd1eb6"
    },
    {
      "source": "Pump 33 DDS syringe pump",
      "predicate": "is attached to",
      "target": "microfluidic device",
      "edgeId": "e8",
      "color": "#dd13ab"
    },
    {
      "source": "SU-8 master",
      "predicate": "is created on",
      "target": "silicon wafer",
      "edgeId": "e9",
      "color": "#55dbd0"
    },
    {
      "source": "mRNA",
      "predicate": "is dissolved in",
      "target": "10mM citrate buffer",
      "edgeId": "e10",
      "color": "#b330c6"
    },
    {
      "source": "organic phase",
      "predicate": "is dissolved in",
      "target": "ethanol",
      "edgeId": "e11",
      "color": "#b330c6"
    },
    {
      "source": "aqueous phase",
      "predicate": "is loaded in",
      "target": "glass syringes",
      "edgeId": "e12",
      "color": "#8e51d3"
    },
    {
      "source": "organic phase",
      "predicate": "is loaded in",
      "target": "glass syringes",
      "edgeId": "e13",
      "color": "#8e51d3"
    },
    {
      "source": "Hamilton Company",
      "predicate": "is located in",
      "target": "Reno, NV",
      "edgeId": "e14",
      "color": "#4215eb"
    },
    {
      "source": "Harvard Apparatus",
      "predicate": "is located in",
      "target": "MA, USA",
      "edgeId": "e15",
      "color": "#4215eb"
    },
    {
      "source": "Teknova",
      "predicate": "is located in",
      "target": "Hollister, CA, USA",
      "edgeId": "e16",
      "color": "#4215eb"
    },
    {
      "source": "1,2-dimyristoyl-rac-glycero-3-methoxypolyethylene glycol-2000 (DMG-PEG2000)",
      "predicate": "is part of",
      "target": "SM-102",
      "edgeId": "e17",
      "color": "#72d458"
    },
    {
      "source": "1,2-distearoyl-sn-glycero-3-phosphocholine (DSPC)",
      "predicate": "is part of",
      "target": "ALC-0315",
      "edgeId": "e18",
      "color": "#72d458"
    },
    {
      "source": "1,2-distearoyl-sn-glycero-3-phosphocholine (DSPC)",
      "predicate": "is part of",
      "target": "SM-102",
      "edgeId": "e19",
      "color": "#72d458"
    },
    {
      "source": "14:0 PEG2000 phosphoethanolamine (C14-PEG2000)",
      "predicate": "is part of",
      "target": "organic phase",
      "edgeId": "e20",
      "color": "#72d458"
    },
    {
      "source": "18:1 Δ9-cis phosphoethanolamine (DOPE)",
      "predicate": "is part of",
      "target": "organic phase",
      "edgeId": "e21",
      "color": "#72d458"
    },
    {
      "source": "ALC-0159",
      "predicate": "is part of",
      "target": "ALC-0315",
      "edgeId": "e22",
      "color": "#72d458"
    },
    {
      "source": "ALC-0315",
      "predicate": "is part of",
      "target": "ALC-0315",
      "edgeId": "e23",
      "color": "#72d458"
    },
    {
      "source": "cholesterol",
      "predicate": "is part of",
      "target": "ALC-0315",
      "edgeId": "e24",
      "color": "#72d458"
    },
    {
      "source": "cholesterol",
      "predicate": "is part of",
      "target": "organic phase",
      "edgeId": "e25",
      "color": "#72d458"
    },
    {
      "source": "cholesterol",
      "predicate": "is part of",
      "target": "SM-102",
      "edgeId": "e26",
      "color": "#72d458"
    },
    {
      "source": "mixing channel",
      "predicate": "is part of",
      "target": "silicon wafer",
      "edgeId": "e27",
      "color": "#72d458"
    },
    {
      "source": "SM-102",
      "predicate": "is part of",
      "target": "SM-102",
      "edgeId": "e28",
      "color": "#72d458"
    },
    {
      "source": "10mM citrate buffer",
      "predicate": "is provided by",
      "target": "Teknova",
      "edgeId": "e29",
      "color": "#37cd65"
    },
    {
      "source": "glass syringes",
      "predicate": "is provided by",
      "target": "Hamilton Company",
      "edgeId": "e30",
      "color": "#37cd65"
    },
    {
      "source": "Pump 33 DDS syringe pump",
      "predicate": "is provided by",
      "target": "Harvard Apparatus",
      "edgeId": "e31",
      "color": "#37cd65"
    },
    {
      "source": "organic phase",
      "predicate": "is used in",
      "target": "B10 formulation",
      "edgeId": "e32",
      "color": "#a0e56e"
    }
  ]
}
    </script>
    <script>
        (function () {
            console.log('[iframe] Script starting - mobile check:', window.innerWidth <= 768);
            console.log('[iframe] User agent:', navigator.userAgent);

            const dataElement = document.getElementById('viz-data');
            if (!dataElement) {
                console.error('[iframe] viz-data element not found!');
                return;
            }

            let vizData;
            try {
                vizData = JSON.parse(dataElement.textContent);
                console.log('[iframe] Data parsed successfully:', vizData.nodes?.length, 'nodes');
            } catch (e) {
                console.error('[iframe] Failed to parse data:', e);
                return;
            }

            const state = {
                activeElement: null,
                focusCluster: null,
                focusPredicate: null,
                searchTerm: '',
                sidebarCollapsed: false,
                sidebarDisabled: false
            };

            const nodeById = Object.fromEntries(vizData.nodes.map(node => [node.id, node]));
            const edgeById = Object.fromEntries(vizData.edges.map(edge => [edge.id, edge]));
            const clusterById = Object.fromEntries(vizData.clusters.map(cluster => [cluster.id, cluster]));
            const edgesByPredicate = {};
            vizData.edges.forEach(edge => {
                if (!edgesByPredicate[edge.predicate]) {
                    edgesByPredicate[edge.predicate] = [];
                }
                edgesByPredicate[edge.predicate].push(edge.id);
            });

            const nodesByCluster = {};
            vizData.clusters.forEach(cluster => {
                cluster.members.forEach(member => {
                    if (!nodesByCluster[cluster.id]) {
                        nodesByCluster[cluster.id] = new Set();
                    }
                    nodesByCluster[cluster.id].add(member);
                });
            });

            function renderStats() {
                const grid = document.getElementById('statsGrid');
                const stats = vizData.stats;
                const entries = [
                    { label: 'Entities', value: stats.entities },
                    { label: 'Relations', value: stats.relations },
                    { label: 'Relation types', value: stats.relationTypes },
                    { label: 'Entity clusters', value: stats.entityClusters },
                    { label: 'Edge clusters', value: stats.edgeClusters },
                    { label: 'Isolated entities', value: stats.isolatedEntities },
                    { label: 'Components', value: stats.components },
                    { label: 'Average degree', value: stats.averageDegree }
                ];
                grid.innerHTML = entries
                    .map(entry => `
                        <div class="stat-card">
                            <div class="stat-value">${entry.value}</div>
                            <div>${entry.label}</div>
                        </div>
                    `)
                    .join('');
            }

            function renderTopLists() {
                const topEntitiesContainer = document.getElementById('topEntities');
                const topRelationsContainer = document.getElementById('topRelations');

                const entityItems = vizData.topEntities.map(item => {
                    const clusterLabel = item.cluster ? `${item.cluster}` : 'Unclustered';
                    return `
                        <div class="list-item">
                            <div>
                                <strong>${item.label}</strong>
                                <div class="meta">Cluster: ${clusterLabel}</div>
                            </div>
                            <div>${item.degree}</div>
                        </div>
                    `;
                });
                topEntitiesContainer.innerHTML = entityItems.join('') || '<div class="meta">No entities</div>';

                const relationItems = vizData.topRelations.map(item => `
                    <div class="list-item relation-item" data-predicate="${item.predicate}">
                        <div>
                            <strong>${item.predicate}</strong>
                            <div class="meta">${item.count} relations</div>
                        </div>
                        <div class="pill" style="background: ${item.color}1a; border: 1px solid ${item.color};">${item.count}</div>
                    </div>
                `);
                topRelationsContainer.innerHTML = relationItems.join('') || '<div class="meta">No relations</div>';
            }

            function renderClusters() {
                const container = document.getElementById('clusterList');
                if (!vizData.clusters.length) {
                    container.innerHTML = '<div class="meta">No cluster information provided.</div>';
                    return;
                }
                container.innerHTML = vizData.clusters
                    .map(cluster => `
                        <button class="list-item cluster-item" data-cluster="${cluster.id}" style="border-left-color: ${cluster.color};">
                            <div>
                                <strong>${cluster.label}</strong>
                                <div class="meta">${cluster.size} members</div>
                            </div>
                            <span class="legend-swatch" style="background: ${cluster.color};"></span>
                        </button>
                    `)
                    .join('');
            }

            // function renderRelationsTable() {
            //     const tbody = document.getElementById('relationsTable');
            //     tbody.innerHTML = vizData.relations
            //         .map(rel => `
            //             <tr data-edge="${rel.edgeId}">
            //                 <td>${rel.source}</td>
            //                 <td><span class="pill" style="border: 1px solid ${rel.color}; background: ${rel.color}1a;">${rel.predicate}</span></td>
            //                 <td>${rel.target}</td>
            //             </tr>
            //         `)
            //         .join('');
            // }

            // function renderInsights() {
            //     const insights = document.getElementById('insightsContent');
            //     const clusters = vizData.clusters
            //         .map(cluster => `
            //             <div class="list-item" style="border-left: 4px solid ${cluster.color};">
            //                 <div>
            //                     <strong>${cluster.label}</strong>
            //                     <div class="meta">Members: ${cluster.members.join(', ')}</div>
            //                 </div>
            //                 <div>${cluster.size}</div>
            //             </div>
            //         `)
            //         .join('');

            //     const components = vizData.components
            //         .map((component, index) => `
            //             <div class="list-item">
            //                 <div>
            //                     <strong>Component ${index + 1}</strong>
            //                     <div class="meta">${component.members.join(', ')}</div>
            //                 </div>
            //                 <div>${component.size}</div>
            //             </div>
            //         `)
            //         .join('');

            //     const isolates = vizData.isolatedEntities.length
            //         ? vizData.isolatedEntities.join(', ')
            //         : 'None';

            //     insights.innerHTML = `
            //         <div class="section">
            //             <h2>Clusters</h2>
            //             <div class="list">${clusters || '<div class="meta">No clusters</div>'}</div>
            //         </div>
            //         <div class="section">
            //             <h2>Connected components</h2>
            //             <div class="list">${components || '<div class="meta">Single connected component</div>'}</div>
            //         </div>
            //         <div class="section">
            //             <h2>Isolated entities</h2>
            //             <div class="meta">${isolates}</div>
            //         </div>
            //     `;
            // }

            function setActiveElement(element) {
                state.activeElement = element;
                renderSelectionDetails();
                updateHighlights();

                // Notify parent about selection change
                if (window.parent !== window && state.sidebarDisabled) {
                    const selection = element ? {
                        type: element.type,
                        id: element.id,
                        ...getElementDetails(element)
                    } : null;
                    window.parent.postMessage({
                        type: 'selectionChanged',
                        selection: selection
                    }, '*');
                }
            }

            function getElementDetails(element) {
                if (!element) return {};

                if (element.type === 'node') {
                    const node = nodeById[element.id];
                    return {
                        label: node.label,
                        cluster: node.cluster,
                        degree: node.degree,
                        indegree: node.indegree,
                        outdegree: node.outdegree,
                        neighbors: node.neighbors
                    };
                } else if (element.type === 'edge') {
                    const edge = edgeById[element.id];
                    return {
                        source: edge.source,
                        target: edge.target,
                        predicate: edge.predicate,
                        cluster: edge.cluster
                    };
                }
                return {};
            }

            function clearActiveElement() {
                state.activeElement = null;
                renderSelectionDetails();
                updateHighlights();
            }

            function renderSelectionDetails() {
                const panel = document.getElementById('selectionDetails');
                const active = state.activeElement;
                if (!active) {
                    panel.innerHTML = 'Click a node or relation in the network to inspect details.';
                    return;
                }

                if (active.type === 'node') {
                    const node = nodeById[active.id];
                    const cluster = node.cluster ? `Cluster: ${node.cluster}` : 'Unclustered';
                    const neighbors = node.neighbors.length ? node.neighbors.join(', ') : 'None';
                    panel.innerHTML = `
                        <h3>${node.label}</h3>
                        <ul>
                            <li>${cluster}</li>
                            <li>Total degree: ${node.degree}</li>
                            <li>Outgoing: ${node.outdegree}</li>
                            <li>Incoming: ${node.indegree}</li>
                            <li>Neighbors: ${neighbors}</li>
                        </ul>
                    `;
                } else if (active.type === 'edge') {
                    const edge = edgeById[active.id];
                    const cluster = edge.cluster ? `Cluster: ${edge.cluster}` : 'Unclustered';
                    panel.innerHTML = `
                        <h3>${edge.source} → ${edge.target}</h3>
                        <ul>
                            <li>Relation: ${edge.predicate}</li>
                            <li>${cluster}</li>
                        </ul>
                    `;
                }
            }

            function toggleClusterFocus(clusterId) {
                if (state.focusCluster === clusterId) {
                    state.focusCluster = null;
                } else {
                    state.focusCluster = clusterId;
                }
                updateActiveButtons();
                updateHighlights();
            }

            function togglePredicateFocus(predicate) {
                if (state.focusPredicate === predicate) {
                    state.focusPredicate = null;
                } else {
                    state.focusPredicate = predicate;
                }
                updateActiveButtons();
                updateHighlights();
            }

            function updateActiveButtons() {
                document.querySelectorAll('.cluster-item').forEach(item => {
                    const clusterId = item.getAttribute('data-cluster');
                    item.classList.toggle('active', state.focusCluster === clusterId);
                });
                document.querySelectorAll('.relation-item').forEach(item => {
                    const predicate = item.getAttribute('data-predicate');
                    item.classList.toggle('active', state.focusPredicate === predicate);
                });
            }

            // Canvas-based network visualization
            let canvas, ctx, transform, simulation;
            let nodes, edges;
            let highlightedNodes = new Set();
            let highlightedEdges = new Set();
            let isFiltering = false;

            function createNetwork() {
                console.log('[iframe] createNetwork starting...');

                if (typeof d3 === 'undefined') {
                    console.error('[iframe] D3.js not loaded!');
                    return;
                }
                console.log('[iframe] D3.js version:', d3.version);

                canvas = document.getElementById('networkCanvas');
                if (!canvas) {
                    console.error('[iframe] Canvas element not found!');
                    return;
                }

                ctx = canvas.getContext('2d');
                if (!ctx) {
                    console.error('[iframe] Canvas context not available!');
                    return;
                }

                // Force a layout recalculation to ensure proper sizing
                canvas.offsetHeight; // Trigger reflow

                // Set canvas size with device pixel ratio for crisp rendering
                const rect = canvas.getBoundingClientRect();
                console.log('[iframe] Canvas rect:', rect.width, 'x', rect.height);

                // Ensure minimum size for mobile/narrow viewports
                const width = Math.max(rect.width, 320);
                const height = Math.max(rect.height, 200);

                const dpr = window.devicePixelRatio || 1;
                canvas.width = width * dpr;
                canvas.height = height * dpr;
                ctx.scale(dpr, dpr);
                canvas.style.width = width + 'px';
                canvas.style.height = height + 'px';

                // Initialize transform for zooming/panning
                transform = d3.zoomIdentity;

                // Clone data for simulation
                nodes = vizData.nodes.map(node => ({ ...node }));
                edges = vizData.edges.map(edge => ({ ...edge }));

                // Create D3 force simulation
                simulation = d3
                    .forceSimulation(nodes)
                    .force('link', d3.forceLink(edges).id(d => d.id).distance(120).strength(0.3))
                    .force('charge', d3.forceManyBody().strength(-280))
                    .force('center', d3.forceCenter(width / 2, height / 2))
                    .force('collision', d3.forceCollide().radius(d => d.radius + 12));

                // Set up zoom behavior
                const zoom = d3.zoom()
                    .scaleExtent([0.25, 3])
                    .on('zoom', (event) => {
                        transform = event.transform;
                        render();
                    });

                d3.select(canvas).call(zoom);

                // Mouse interaction handling
                let draggedNode = null;
                let mouseX, mouseY;

                function getMousePos(event) {
                    const rect = canvas.getBoundingClientRect();
                    return {
                        x: (event.clientX - rect.left - transform.x) / transform.k,
                        y: (event.clientY - rect.top - transform.y) / transform.k
                    };
                }

                function findNode(x, y) {
                    for (let i = nodes.length - 1; i >= 0; i--) {
                        const node = nodes[i];
                        const dx = x - node.x;
                        const dy = y - node.y;
                        if (dx * dx + dy * dy < node.radius * node.radius) {
                            return node;
                        }
                    }
                    return null;
                }

                function findEdge(x, y) {
                    for (let i = edges.length - 1; i >= 0; i--) {
                        const edge = edges[i];
                        if (!edge.source || !edge.target) continue;

                        // Check if click is near the edge line
                        const dx = edge.target.x - edge.source.x;
                        const dy = edge.target.y - edge.source.y;
                        const length = Math.sqrt(dx * dx + dy * dy);
                        if (length === 0) continue;

                        const dot = ((x - edge.source.x) * dx + (y - edge.source.y) * dy) / (length * length);
                        if (dot < 0 || dot > 1) continue;

                        const projX = edge.source.x + dot * dx;
                        const projY = edge.source.y + dot * dy;
                        const distSq = (x - projX) * (x - projX) + (y - projY) * (y - projY);

                        if (distSq < 25) { // 5px threshold
                            return edge;
                        }
                    }
                    return null;
                }

                canvas.addEventListener('mousedown', (event) => {
                    const pos = getMousePos(event);
                    mouseX = pos.x;
                    mouseY = pos.y;
                    draggedNode = findNode(pos.x, pos.y);

                    if (draggedNode) {
                        simulation.alphaTarget(0.3).restart();
                        draggedNode.fx = draggedNode.x;
                        draggedNode.fy = draggedNode.y;
                        canvas.style.cursor = 'grabbing';
                    }
                });

                canvas.addEventListener('mousemove', (event) => {
                    const pos = getMousePos(event);

                    if (draggedNode) {
                        draggedNode.fx = pos.x;
                        draggedNode.fy = pos.y;
                    } else {
                        // Update cursor based on what's under mouse
                        const node = findNode(pos.x, pos.y);
                        const edge = findEdge(pos.x, pos.y);
                        canvas.style.cursor = (node || edge) ? 'pointer' : 'grab';
                    }
                });

                canvas.addEventListener('mouseup', (event) => {
                    if (draggedNode) {
                        simulation.alphaTarget(0);
                        draggedNode.fx = null;
                        draggedNode.fy = null;
                        draggedNode = null;
                        canvas.style.cursor = 'grab';
                    }
                });

                canvas.addEventListener('click', (event) => {
                    const pos = getMousePos(event);
                    const node = findNode(pos.x, pos.y);
                    const edge = findEdge(pos.x, pos.y);

                    if (node) {
                        setActiveElement({ type: 'node', id: node.id });
                    } else if (edge) {
                        setActiveElement({ type: 'edge', id: edge.id });
                    } else {
                        clearActiveElement();
                    }
                });

                // Animation loop
                simulation.on('tick', () => {
                    render();
                });

                // Handle window resize
                window.addEventListener('resize', resizeCanvas);

                render();
            }

            function resizeCanvas() {
                if (!canvas || !ctx) return;

                // Force canvas to take full container size
                if (state.sidebarDisabled) {
                    canvas.style.width = '100%';
                    canvas.style.height = '100%';
                }

                const rect = canvas.getBoundingClientRect();
                console.log('Canvas resize - rect:', rect.width, 'x', rect.height);

                // Ensure minimum size for mobile
                const width = Math.max(rect.width, 320);
                const height = Math.max(rect.height, 200);

                const dpr = window.devicePixelRatio || 1;
                canvas.width = width * dpr;
                canvas.height = height * dpr;
                ctx.scale(dpr, dpr);
                canvas.style.width = width + 'px';
                canvas.style.height = height + 'px';

                // Update simulation center
                if (simulation) {
                    simulation.force('center', d3.forceCenter(width / 2, height / 2));
                    simulation.alpha(0.3).restart();
                }

                render();
            }


            function render() {
                if (!ctx || !canvas) return;

                // Clear canvas
                ctx.clearRect(0, 0, canvas.width / (window.devicePixelRatio || 1),
                             canvas.height / (window.devicePixelRatio || 1));

                // Apply transform
                ctx.save();
                ctx.translate(transform.x, transform.y);
                ctx.scale(transform.k, transform.k);

                // Set text properties
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.font = '12px Inter, system-ui, sans-serif';

                // Draw edges first
                edges.forEach(edge => {
                    if (!edge.source || !edge.target) return;

                    const isHighlighted = highlightedEdges.has(edge.id);
                    const isDimmed = isFiltering && !isHighlighted;

                    // Calculate edge endpoints accounting for node radius
                    const dx = edge.target.x - edge.source.x;
                    const dy = edge.target.y - edge.source.y;
                    const distance = Math.sqrt(dx * dx + dy * dy) || 1;
                    const normX = dx / distance;
                    const normY = dy / distance;

                    const sourcePadding = edge.source.radius + 2;
                    const targetPadding = edge.target.radius + 8;
                    const sourceX = edge.source.x + normX * sourcePadding;
                    const sourceY = edge.source.y + normY * sourcePadding;
                    const targetX = edge.target.x - normX * targetPadding;
                    const targetY = edge.target.y - normY * targetPadding;

                    // Draw edge line
                    ctx.strokeStyle = edge.color;
                    ctx.globalAlpha = isDimmed ? 0.15 : (isHighlighted ? 1.0 : 0.55);
                    ctx.lineWidth = 1.4;
                    ctx.beginPath();
                    ctx.moveTo(sourceX, sourceY);
                    ctx.lineTo(targetX, targetY);
                    ctx.stroke();

                    // Draw arrowhead
                    const arrowLength = 10;
                    const arrowWidth = 5;
                    const angle = Math.atan2(dy, dx);

                    ctx.fillStyle = '#94a3b8';
                    ctx.beginPath();
                    ctx.moveTo(targetX, targetY);
                    ctx.lineTo(
                        targetX - arrowLength * Math.cos(angle - arrowWidth * Math.PI / 180),
                        targetY - arrowLength * Math.sin(angle - arrowWidth * Math.PI / 180)
                    );
                    ctx.lineTo(
                        targetX - arrowLength * Math.cos(angle + arrowWidth * Math.PI / 180),
                        targetY - arrowLength * Math.sin(angle + arrowWidth * Math.PI / 180)
                    );
                    ctx.closePath();
                    ctx.fill();

                    // Draw edge label if zoom level is appropriate
                    if (transform.k > 0.8) {
                        const labelX = (sourceX + targetX) / 2;
                        const labelY = (sourceY + targetY) / 2;

                        ctx.fillStyle = isDimmed ? 'rgba(30, 41, 59, 0.15)' : 'rgba(30, 41, 59, 0.8)';
                        ctx.font = '10px Inter, system-ui, sans-serif';
                        ctx.fillText(edge.predicate, labelX, labelY);
                    }
                });

                // Draw nodes
                nodes.forEach(node => {
                    const isHighlighted = highlightedNodes.has(node.id);
                    const isDimmed = isFiltering && !isHighlighted;

                    // Draw node circle
                    ctx.fillStyle = node.color;
                    ctx.globalAlpha = isDimmed ? 0.15 : 1.0;
                    ctx.beginPath();
                    ctx.arc(node.x, node.y, node.radius, 0, 2 * Math.PI);
                    ctx.fill();

                    // Draw node border
                    ctx.strokeStyle = '#0f172a';
                    ctx.lineWidth = isHighlighted ? 2.4 : 1.2;
                    ctx.stroke();

                    // Draw node label
                    if (transform.k > 0.5) {
                        ctx.fillStyle = isDimmed ? 'rgba(15, 23, 42, 0.15)' : '#0f172a';
                        ctx.font = '12px Inter, system-ui, sans-serif';
                        ctx.fillText(node.label, node.x, node.y + node.radius + 14);
                    }
                });

                ctx.restore();
                ctx.globalAlpha = 1.0;
            }

            function updateHighlights() {
                // Clear previous highlights
                highlightedNodes.clear();
                highlightedEdges.clear();
                isFiltering = false;

                const addNode = id => {
                    if (id) {
                        highlightedNodes.add(id);
                    }
                };
                const addEdge = id => {
                    if (id) {
                        highlightedEdges.add(id);
                    }
                };

                if (state.activeElement) {
                    isFiltering = true;
                    if (state.activeElement.type === 'node') {
                        const node = nodeById[state.activeElement.id];
                        addNode(node.id);
                        node.neighbors.forEach(addNode);
                        (node.edgeIds.outgoing || []).forEach(addEdge);
                        (node.edgeIds.incoming || []).forEach(addEdge);
                    } else if (state.activeElement.type === 'edge') {
                        const edge = edgeById[state.activeElement.id];
                        addEdge(edge.id);
                        addNode(edge.source);
                        addNode(edge.target);
                    }
                }

                if (state.focusCluster && nodesByCluster[state.focusCluster]) {
                    isFiltering = true;
                    nodesByCluster[state.focusCluster].forEach(addNode);
                    vizData.edges.forEach(edge => {
                        if (
                            nodesByCluster[state.focusCluster].has(edge.source) &&
                            nodesByCluster[state.focusCluster].has(edge.target)
                        ) {
                            addEdge(edge.id);
                        }
                    });
                }

                if (state.focusPredicate && edgesByPredicate[state.focusPredicate]) {
                    isFiltering = true;
                    edgesByPredicate[state.focusPredicate].forEach(edgeId => {
                        addEdge(edgeId);
                        const edge = edgeById[edgeId];
                        addNode(edge.source);
                        addNode(edge.target);
                    });
                }

                if (state.searchTerm) {
                    const term = state.searchTerm.toLowerCase();
                    isFiltering = true;
                    vizData.nodes.forEach(node => {
                        if (node.label.toLowerCase().includes(term)) {
                            addNode(node.id);
                            node.neighbors.forEach(addNode);
                        }
                    });
                    vizData.edges.forEach(edge => {
                        if (edge.predicate.toLowerCase().includes(term)) {
                            addEdge(edge.id);
                            addNode(edge.source);
                            addNode(edge.target);
                        }
                    });
                }

                // Trigger re-render with updated highlights
                render();
            }

            function toggleSidebar() {
                if (state.sidebarDisabled) return;

                state.sidebarCollapsed = !state.sidebarCollapsed;
                const layout = document.querySelector('.layout');
                const sidebar = document.querySelector('.sidebar');
                const toggleButton = document.getElementById('sidebarToggle');

                layout.classList.toggle('sidebar-collapsed', state.sidebarCollapsed);
                sidebar.classList.toggle('collapsed', state.sidebarCollapsed);
                toggleButton.classList.toggle('collapsed', state.sidebarCollapsed);

                // Trigger canvas resize when sidebar toggles
                setTimeout(() => {
                    resizeCanvas();
                }, 300); // Wait for transition to complete
            }

            function disableSidebar() {
                state.sidebarDisabled = true;

                const layout = document.querySelector('.layout');
                const sidebar = document.querySelector('.sidebar');
                const toggleButton = document.getElementById('sidebarToggle');
                const main = document.querySelector('.main');
                const tabPanel = document.querySelector('.tab-panel');
                const networkPanel = document.querySelector('.network-panel');

                layout.classList.add('sidebar-disabled');
                sidebar.style.display = 'none';
                toggleButton.style.display = 'none';

                // Force styles directly for iframe context
                main.style.width = '100%';
                main.style.height = '100vh';
                tabPanel.style.padding = '0';
                tabPanel.style.width = '100%';
                tabPanel.style.height = '100vh';
                networkPanel.style.width = '100%';
                networkPanel.style.height = '100vh';
                networkPanel.style.borderRadius = '0';
                networkPanel.style.border = 'none';

                console.log('Sidebar disabled, forcing full width styles');

                // Multiple resize attempts with forced reflow
                setTimeout(() => {
                    canvas.offsetHeight; // Trigger reflow
                    console.log('First resize attempt after 200ms');
                    resizeCanvas();
                }, 200);

                setTimeout(() => {
                    canvas.offsetHeight; // Trigger reflow
                    console.log('Second resize attempt after 500ms');
                    resizeCanvas();
                }, 500);

                setTimeout(() => {
                    canvas.offsetHeight; // Trigger reflow
                    console.log('Final resize attempt after 800ms');
                    resizeCanvas();
                }, 800);

                // Notify parent about graph data
                if (window.parent !== window) {
                    window.parent.postMessage({
                        type: 'graphDataReady',
                        data: vizData
                    }, '*');
                }
            }

            function bindInteractions() {
                document.querySelectorAll('.cluster-item').forEach(item => {
                    item.addEventListener('click', () => toggleClusterFocus(item.getAttribute('data-cluster')));
                });

                document.querySelectorAll('.relation-item').forEach(item => {
                    item.addEventListener('click', () => togglePredicateFocus(item.getAttribute('data-predicate')));
                });

                // document.getElementById('relationsTable').addEventListener('click', event => {
                //     const row = event.target.closest('tr');
                //     if (!row) {
                //         return;
                //     }
                //     const edgeId = row.getAttribute('data-edge');
                //     if (edgeId) {
                //         setActiveElement({ type: 'edge', id: edgeId });
                //     }
                // });

                const searchInput = document.getElementById('searchInput');
                searchInput.addEventListener('input', () => {
                    state.searchTerm = searchInput.value.trim();
                    updateHighlights();

                    // Notify parent about search change
                    if (window.parent !== window && state.sidebarDisabled) {
                        window.parent.postMessage({
                            type: 'searchChanged',
                            searchTerm: state.searchTerm
                        }, '*');
                    }
                });
                searchInput.addEventListener('keydown', event => {
                    if (event.key === 'Escape') {
                        searchInput.value = '';
                        state.searchTerm = '';
                        updateHighlights();
                    }
                });

                document.querySelectorAll('.tab').forEach(tab => {
                    tab.addEventListener('click', event => {
                        const target = event.currentTarget;
                        document.querySelectorAll('.tab').forEach(button => button.classList.remove('active'));
                        target.classList.add('active');
                        const tabId = target.getAttribute('data-tab');
                        document.querySelectorAll('.tab-panel').forEach(panel => {
                            panel.classList.toggle('active', panel.id === tabId);
                        });
                    });
                });

                document.getElementById('sidebarToggle').addEventListener('click', toggleSidebar);

                // Listen for messages from parent
                window.addEventListener('message', (event) => {
                    if (event.data.type === 'disableInternalSidebar') {
                        disableSidebar();
                    } else if (event.data.type === 'search') {
                        state.searchTerm = event.data.term || '';
                        updateHighlights();
                    } else if (event.data.type === 'focusCluster') {
                        toggleClusterFocus(event.data.clusterId);
                    } else if (event.data.type === 'focusPredicate') {
                        togglePredicateFocus(event.data.predicate);
                    }
                });

            }

            renderStats();
            renderTopLists();
            renderClusters();
            // renderRelationsTable();
            // renderInsights();

            // Delay network creation to ensure proper layout
            setTimeout(() => {
                createNetwork();
                bindInteractions();
            }, 100);
        })();
    </script>
</body>

</html>